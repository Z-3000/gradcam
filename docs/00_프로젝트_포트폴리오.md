# X-ray Grad-CAM Explorer 프로젝트 포트폴리오

## 프로젝트 한 줄 요약

**"흉부 X-ray 이미지에서 폐렴을 분류하고, Grad-CAM으로 모델의 판단 근거를 시각화하는 딥러닝 웹 애플리케이션"**

---

## 데모 링크

- **Live Demo**: [HuggingFace Spaces](https://huggingface.co/spaces/JH3907/xraygradcam)
- **GitHub**: [Z-3000/gradcam](https://github.com/Z-3000/gradcam)

---

## 기술 스택

| 분류 | 기술 | 용도 |
|------|------|------|
| 웹 프레임워크 | Streamlit 1.51.0 | 인터랙티브 웹 UI |
| 딥러닝 | PyTorch, torchvision | 모델 추론 및 Grad-CAM |
| 영상처리 | OpenCV, Pillow | 이미지 전처리/시각화 |
| 의료영상 | pydicom | DICOM 파싱 및 HU 변환 |
| 배포 | HuggingFace Spaces | 서버리스 호스팅 |
| CI/CD | GitHub Actions | 자동 배포 파이프라인 |
| 버전관리 | Git LFS | 대용량 모델 파일 관리 |

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                    HuggingFace Spaces                       │
│                                                             │
│  [이미지 업로드] → [main.py] → [Grad-CAM 시각화]            │
│   DICOM/PNG/JPG    Streamlit     히트맵 오버레이            │
│                        │                                    │
│                        ▼                                    │
│               [grandcam_core.py]                            │
│                모델 추론 + Grad-CAM 계산                    │
│                        │                                    │
│        ┌───────────────┼───────────────┐                   │
│        ▼               ▼               ▼                   │
│   [ResNet18]    [EfficientNet]   [DenseNet121]             │
│   (th=0.25)      (th=0.15)        (th=0.18)               │
└─────────────────────────────────────────────────────────────┘
```

---

## 주요 기능

| 기능 | 설명 |
|------|------|
| **다중 포맷 지원** | DICOM, PNG, JPEG 흉부 X-ray 이미지 업로드 |
| **3개 모델 지원** | ResNet18, EfficientNet-B0, DenseNet121 |
| **Grad-CAM 시각화** | 모델이 주목한 영역을 히트맵으로 표시 |
| **비교 모드** | 3개 모델 결과를 한 화면에서 비교 |
| **DICOM 전처리** | HU 변환 + Lung Window 적용 |

---

## 프로젝트 구조 (모듈 분리 설계)

```
xraygradcam/
├── main.py              # UI 전담 (Streamlit)
├── grandcam_core.py     # 비즈니스 로직 (Grad-CAM 계산)
├── config.py            # 설정 중앙 관리 (모델, threshold)
├── styles.py            # CSS 스타일 관리 (테마)
├── checkpoints/         # 모델 가중치 (Git LFS)
│   ├── 251115_resnet18_NP.pth
│   ├── 251115_efficientnet_NP.pth
│   └── 251115_densenet121_NP.pth
├── requirements.txt     # 의존성
└── .github/workflows/   # HuggingFace 자동 동기화
```

### 모듈 역할

| 모듈 | 역할 | 확장 포인트 |
|------|------|-------------|
| `config.py` | 설정 중앙 관리 | 모델 추가 시 `MODEL_CONFIG`에 항목 추가 |
| `styles.py` | CSS 테마 관리 | 새 테마 추가 가능 |
| `grandcam_core.py` | Grad-CAM 로직 | FastAPI 등 다른 프레임워크에서 재사용 |
| `main.py` | Streamlit UI | UI 변경 시 이 파일만 수정 |

---

## 핵심 설계 결정

| 결정 사항 | 왜 그렇게 했는지 |
|-----------|------------------|
| 모듈 분리 (config/core/styles/main) | 관심사 분리로 유지보수성 향상, 다른 프레임워크에서 재사용 가능 |
| 이진 분류 (출력 1개) | 의료 진단 특성상 Recall 우선, threshold 조정 용이 |
| 모델별 최적 threshold | ROC 분석 기반 최적값 사용 (ResNet 0.25, EfficientNet 0.15, DenseNet 0.18) |
| DICOM Lung Window | 학습 시 동일 파라미터 사용 (WC=40, WW=800) → 성능 보존 |
| Git LFS | 모델 파일(~89MB each)을 Git에서 효율적으로 관리 |
| GitHub Actions | main 브랜치 push 시 HuggingFace로 자동 배포 |

---

## 배포 파이프라인

```
[로컬 개발] → [GitHub Push] → [GitHub Actions] → [HuggingFace Spaces]
                  main             자동 트리거         Live 배포
```

- `main` 브랜치 push 시 자동 동기화
- `.github/workflows/sync-to-huggingface.yml` 설정

---

## 개발 과정 및 문제 해결

### 1. DICOM 전처리 일관성
- **문제**: 학습 시와 추론 시 DICOM 전처리가 달라 성능 저하
- **해결**: `config.py`에 Window Center/Width를 중앙 관리하여 일관성 유지

### 2. 모델별 threshold 최적화
- **문제**: 기본 threshold(0.5)로는 Recall이 낮음
- **해결**: ROC 분석 후 모델별 최적 threshold 적용 (의료 진단은 Recall 우선)

### 3. 대용량 모델 파일 관리
- **문제**: 모델 파일(~267MB)이 GitHub 용량 제한 초과
- **해결**: Git LFS로 `.pth` 파일 별도 관리

### 4. 모듈 분리 리팩토링
- **문제**: 단일 파일에 모든 코드가 있어 유지보수 어려움
- **해결**: config/styles/core/main으로 분리하여 관심사 분리

---

## GitHub / 시연

- **GitHub**: [https://github.com/Z-3000/gradcam](https://github.com/Z-3000/gradcam)
- **Live Demo**: [https://huggingface.co/spaces/JH3907/xraygradcam](https://huggingface.co/spaces/JH3907/xraygradcam)
